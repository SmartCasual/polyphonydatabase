<h1>Cataloguing</h1>

<%= form_tag("/admin/sources/switch-to", class: "composer-select") do %>
  <%= select_tag "id", grouped_options_for_select(@grouped_sources, params[:id]) %>

  <button>Edit</button>
<% end %>

<hr>

<%= form_for([:admin, @source], url: admin_source_path(@source, page: params[:page])) do |f| %>
  <div class="sourcebasics">
      <%= f.text_field :code %>
      <%= f.text_area :title %>
      <%= f.select :publisher_ids,
        Publisher.order(:name).map {|pub| [pub.name, pub.id] },
        {
          label: "Publishers",
        },
        {
          class: "select2",
          multiple: true
        }
      %>
      <%= f.select :scribe_ids,
        Scribe.order(:name).map {|s| [s.name, s.id] },
        {
          label: "Scribes",
        },
        {
          class: "select2",
          multiple: true
        }
      %>
      <%= f.text_field :town %>
      <div class="dates">
        <div class="prefix">
         From date:
         <%= f.text_field :from_year_annotation %>
         <%= f.text_field :from_year %>
        </div>
        <div class="prefix">
         to
         <%= f.text_field :to_year_annotation %>
         <%= f.text_field :to_year %>
        </div>
      </div>
      <%= f.select :type, Source::TYPES.map { |s| [s, s] } %>
      <%= f.select :format, Source::FORMATS.map { |f| [f, f] } %>
      <%= f.text_field :rism_link, label: "RISM URL" %>
      <%= f.text_field :url, label: "Image URL" %>
      <%= f.check_box :catalogued %>
  </div>

  <button class="save">Save</button>

  <%= paginate @inclusions %>

  <table class="cataloguing">
    <tr>
      <th class="order">Order</th>
      <th class="attributed-to">Attributed to</th>
      <th class="title">Title</th>
      <th class="clefs">Clefs</th>
      <th class="notes">Notes</th>
      <th class="delete">Delete</th>
      <th></th>
    </tr>

    <% composer_list = Composer.order(:name).map {|c| [c.name, c.id] } %>
    <%= render "catalogue_set", inclusions: @inclusions, composer_list: composer_list, f: f %>

    <% if @blank_inclusions %>
      <%= render "catalogue_set", inclusions: @blank_inclusions, composer_list: composer_list, f: f %>
    <% end %>
  </table>

  <%= paginate @inclusions %>

  <button class="save">Save</button>
<% end %>
